---
import Layout from "../../layouts/Layout.astro";
import SEO from "../../components/SEO.astro";
import { BLOG_POSTS } from "../../data/blog";
import type { BlogPost } from "../../data/blog";
import '../../styles/blog.css';
import { getRelatedPosts, buildPostUrl } from '../../data/blog-utils';
import { type Language } from "../../i18n";

export async function getStaticPaths() {
  return BLOG_POSTS.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

interface Props {
  post: BlogPost;
}

const { post } = Astro.props;

// Detectar idioma desde URL
import { getCurrentLanguage, getLocalizedPath, useTranslations, getBlogTranslation } from "../../i18n";
const currentLang = getCurrentLanguage(Astro);
const t = useTranslations(currentLang);
const getPath = (path: string) => getLocalizedPath(path, currentLang);

// Obtener traducciones del blog
const blogTrans = getBlogTranslation(post.slug, currentLang);
const postTitle = blogTrans?.title || post.title;
const postExcerpt = blogTrans?.excerpt || post.excerpt;
const postCategory = blogTrans?.category || post.category;
const postContent = blogTrans?.content || post.content;

// Obtener posts relacionados (misma categoría, excluyendo el actual)
const relatedPosts = getRelatedPosts(BLOG_POSTS, post.slug, post.category, 3);

const postUrl = buildPostUrl(post.slug, getPath);
---

<Layout>
  <SEO
    title={`${postTitle} | ${currentLang === 'en' ? 'Blog ORO INCA Jewelry' : 'Blog ORO INCA Joyería'}`}
    description={postExcerpt}
    canonical={`/blog/${post.slug}`}
    ogImage={post.image}
    ogType="article"
    keywords={`${postCategory}, ${postTitle}, blog joyería, consejos joyería`}
    lang={currentLang}
    structuredData={{
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "headline": postTitle,
      "description": postExcerpt,
      "image": post.image,
      "datePublished": post.date,
      "dateModified": post.date,
      "author": {
        "@type": "Organization",
        "name": "ORO INCA Joyería",
        "url": "https://oro-inca-joyeria.vercel.app"
      },
      "publisher": {
        "@type": "Organization",
        "name": "ORO INCA Joyería",
        "logo": {
          "@type": "ImageObject",
          "url": "https://oro-inca-joyeria.vercel.app/assets/img/logo.png"
        }
      },
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": postUrl
      },
      "articleSection": postCategory
    }}
  />
  <article class="pt-24 pb-16">
    <div class="max-w-4xl mx-auto px-6">
      
      <!-- Breadcrumb -->
      <nav class="mb-8 text-sm">
        <ol class="flex items-center gap-2 text-gray-600">
          <li><a href={getPath("/")} class="hover:text-[#d4af37] transition">{t('nav.inicio')}</a></li>
          <li>/</li>
          <li><a href={getPath("/blog")} class="hover:text-[#d4af37] transition">{t('nav.blog')}</a></li>
          <li>/</li>
          <li class="text-gray-900 font-medium">{postTitle}</li>
        </ol>
      </nav>

      <!-- Header del Artículo -->
      <header class="mb-12">
        <span class="inline-block px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium mb-4">
          {postCategory}
        </span>
        <h1 class="text-4xl md:text-5xl font-bold text-[#16273b] mb-6">
          {postTitle}
        </h1>
        <div class="flex items-center gap-4 text-gray-600">
          <span>{post.date}</span>
          <span>•</span>
          <span>{post.author}</span>
        </div>
      </header>

      <!-- Imagen Principal -->
      <div class="mb-12 rounded-md overflow-hidden shadow-lg">
        <img
          src={post.image}
          alt={postTitle}
          class="w-full h-auto object-cover"
        />
      </div>

      <!-- Contenido del Artículo -->
      <div class="prose prose-lg max-w-none mb-16">
        <div set:html={postContent} />
      </div>

      <!-- Galería de Imágenes Adicionales -->
      {post.images && post.images.length > 0 && (
        <div class="grid md:grid-cols-2 gap-6 mb-16">
          {post.images.map((img, index) => (
            <div class="rounded-md overflow-hidden shadow-md">
              <img
                src={img}
                alt={`${postTitle} - ${currentLang === 'en' ? 'Image' : 'Imagen'} ${index + 1}`}
                class="w-full h-auto object-cover"
              />
            </div>
          ))}
        </div>
      )}

      <!-- Artículos Relacionados -->
      {relatedPosts.length > 0 && (
        <div class="mb-16 pt-16 border-t border-gray-200">
          <h2 class="text-3xl font-bold text-[#16273b] mb-8">
            Artículos Relacionados
          </h2>
          <div class="grid md:grid-cols-3 gap-6">
            {relatedPosts.map((relatedPost) => {
              const relatedTrans = getBlogTranslation(relatedPost.slug, currentLang);
              const relatedTitle = relatedTrans?.title || relatedPost.title;
              const relatedExcerpt = relatedTrans?.excerpt || relatedPost.excerpt;
              const relatedCategory = relatedTrans?.category || relatedPost.category;
              return (
                <a
                  href={getPath(`/blog/${relatedPost.slug}`)}
                  class="bg-white rounded-md overflow-hidden shadow-md hover:shadow-xl transition-shadow block"
                >
                  <div class="h-48 bg-gradient-to-br from-[#d4af37] to-[#b8941f]"></div>
                  <div class="p-6">
                    <span class="text-sm text-gray-500 mb-2 block">{relatedCategory} • {relatedPost.date}</span>
                    <h3 class="text-xl font-bold text-[#16273b] mb-3">
                      {relatedTitle}
                    </h3>
                    <p class="text-gray-600 text-sm">
                      {relatedExcerpt}
                    </p>
                  </div>
                </a>
              );
            })}
          </div>
        </div>
      )}

      <!-- CTA -->
      <div class="bg-gradient-to-r from-[#16273b] to-[#0f1b2d] rounded-md p-8 md:p-12 text-center text-white">
        <h2 class="text-3xl font-bold mb-4">{currentLang === 'en' ? 'Interested in Our Jewelry?' : '¿Interesado en Nuestras Joyas?'}</h2>
        <p class="text-gray-300 mb-6">
          {currentLang === 'en' 
            ? 'Discover our exclusive collection and find the perfect piece for you.'
            : 'Descubre nuestra colección exclusiva y encuentra la pieza perfecta para ti.'}
        </p>
        <div class="flex flex-wrap justify-center gap-4">
          <a
            href={getPath("/products")}
            class="bg-[#d4af37] hover:bg-[#b8941f] text-[#16273b] px-8 py-4 rounded-full font-semibold transition-colors"
          >
            {t('common.verMas')}
          </a>
          <a
            href={getPath("/contact")}
            class="bg-white/10 hover:bg-white/20 text-white px-8 py-4 rounded-full font-semibold transition-colors border border-white/20"
          >
            {t('nav.contacto')}
          </a>
        </div>
      </div>

    </div>
  </article>
</Layout>

<script type="module">
  import { initBlogPage } from '../../js/blog.js';
  initBlogPage();
</script>

