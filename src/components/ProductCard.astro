---
import type { ImageMetadata } from "astro";
import { getLocalizedPath, type Language } from "../i18n";

interface Props {
  id?: number;
  name: string;
  description: string;
  price: number;
  oldPrice?: number;
  image: string | ImageMetadata;
  badge?: string;
  lang?: Language | string;
}

const { id, name, description, price, oldPrice, image, badge, lang = "es" } = Astro.props;

// ðŸ‘‰ Normalizamos la imagen
const imageSrc = typeof image === "string" ? image : image.src;

// Determinar idioma
const currentLang = (lang === "en" || lang === "es") ? lang : "es";

// Si tiene id, envolver en link, si no, solo article
const hasLink = id !== undefined;
const productLink = id ? getLocalizedPath(`/product/${id}`, currentLang) : "";
---

{
  hasLink ? (
    <a href={productLink} class="block">
      <article class="bg-white rounded-md overflow-hidden shadow-lg hover:shadow-xl transition-shadow cursor-pointer">
        <div class="relative">
          {badge && (
            <span class="absolute top-4 left-4 bg-[#d4af37] text-[#16273b] text-xs font-bold px-3 py-1 rounded-full z-10">
              {badge}
            </span>
          )}

          <img
            src={imageSrc}
            alt={name}
            class="h-64 w-full object-cover"
            loading="lazy"
          />
        </div>

        <div class="p-3">
          <h3 class="font-semibold text-lg text-[#16273B]">{name}</h3>
          <p class="text-sm text-gray-600">{description}</p>

          <div class="mt-2 flex gap-2 items-center">
            <span class="text-lg font-bold text-[#d4af37]">S/ {price}</span>

            {oldPrice && (
              <span class="text-sm line-through text-gray-400">
                S/ {oldPrice}
              </span>
            )}
          </div>
        </div>
      </article>
    </a>
  ) : (
    <article class="bg-white rounded-md overflow-hidden shadow-lg">
      <div class="relative">
        {badge && (
          <span class="absolute top-4 left-4 bg-[#d4af37] text-[#16273b] text-xs font-bold px-3 py-1 rounded-full">
            {badge}
          </span>
        )}

        <img
          src={imageSrc}
          alt={name}
          class="h-64 w-full object-cover"
          loading="lazy"
        />
      </div>

      <div class="p-6">
        <h3 class="font-semibold text-lg">{name}</h3>
        <p class="text-sm text-gray-600">{description}</p>

        <div class="mt-4 flex gap-2 items-center">
          <span class="text-lg font-bold text-[#d4af37]">S/ {price}</span>

          {oldPrice && (
            <span class="text-sm line-through text-gray-400">
              S/ {oldPrice}
            </span>
          )}
        </div>
      </div>
    </article>
  )
}
